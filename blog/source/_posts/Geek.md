---
title: Geek
date: 2018-07-19 15:05:31
tags:
---

摘要:
<!--more-->
正文:

数据库分享总结
数据库表设计和查询的原则：存的少；取得少（包括频度少）

存储数据类型的选择决定数据的膨胀速度
	1、业务设计时考虑
	2、影响存储空间、io开销、内存
	3、主键int vs bigint(4 bytes vs 8bytes)
	4、bigint类型值的范围更大，不太适合做主键
	5、每个second index 会包含主键的值
	6、second index指的是除主键外的索引

关于IP，时间的保存
	1、varchar 类型的ip vs int类型的ip
	2、varchar类型表达更直观
	3、int数据类型更节省内存
	4、要根据实际应用场景选择
	5、Datatime vs int
	6、Datatime占据内存为int的2倍，但其存储精度更高，可以存储微妙精度
	7、int只能表示秒，如果要存储更高精度需要bigint，与Datatime占据内存相同
	8、一般使用Datatime

过期的数据是否该一直保存？
	1、过期数据指的是过了业务实效期的数据
	2、过期数据的问题
	3、占据空间，影响DML性能，索引性能（查询需要添加多余查询条件）
	4、占用备份空间，恢复时恢复时间长；同时也会影响磁盘的使用效率

备份策略：周一全备，周二做增备

多余数据解决方法
	1、对于逻辑删除的大量数据，在进行业务评估后清理
	2、对于不在业务处理期内的数据，进行归档并清理
	3、业务模块 下线后完成数据库清理工作

cold数据和warm数据的区分
	如何区分？以减少数据量

注意不要方法用户的数据需求
	对数据库的影响很大，数据量很大


SQL编写规范
	1、SQL查询只查询需要的字段，而不是select *
	2、避免不必要的join操作
	3、避免代码逻辑错误导致的多次重复查询

影响数据库性能的一些案例
1．
	1)避免查询条件由代码循环生成
	2)避免SQL的长度和频度由传入的条件决定
	带来的问题
	sql性能低，是范围查询
	记录日志开销大
解决方法
	业务设计时考虑控制
	代码循环时需要对传入参数的长度有所控制
2.
	数据分布的不均匀会导致sql效率问题
	not null操作不会通过索引查询
	避免sql语句发生隐式转换，即数据库中为varchar，查询为int，发生隐式转换

隐式转换防止方法

注意事项：
	1、插入大量数据使用bulk insert,而不是一条insert一句
	2、ddl语句涉及到单个表的
	3、auto_increament一定要去掉
	4、不建议由开发建立索引，一般由DBA建立
	5、防止ddl、dml混淆
	6、防止中文乱码
	7、sql语句中不能出现集合函数，如count,distinct,sum等；不使用join
	8、避免使用自定义函数，外键（严重禁止，由业务保证完整性），数学运算，存储过程，触发器，视图

常用数据库比较
	1、mysql适用于简单的增删改查
	2、oracle适用于集合函数，进行了相应的优化
	3、mongodb可用于存储结构化数据和文档



	


